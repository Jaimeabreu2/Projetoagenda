<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Agenda — Criar conta</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="login-page">
  <main class="login-wrap" aria-labelledby="signup-title">
    <section class="hero" aria-hidden="false">
      <div class="brand">
        <div class="logo" aria-hidden="false">Ag</div>
        <div>
          <div style="font-weight:700">Projeto Agenda</div>
          <div class="small">Agenda acadêmica — organize suas aulas e compromissos</div>
        </div>
      </div>

      <h1 id="signup-title">Crie sua conta</h1>
      <p>Cadastre-se para começar a usar seu calendário acadêmico.</p>
      <div class="small" style="margin-top:18px">Dica: prefira usar seu e-mail institucional.</div>
    </section>

    <!-- Formulário de cadastro: campos obrigatórios (nome, e-mail, senha).
         O botão "eye" alterna visibilidade da senha para facilitar digitação. -->
    <section class="card" aria-labelledby="form-title">
      <h2 id="form-title"><i class="fa-solid fa-wheelchair"></i> Crie sua conta</h2>

      <form id="signupForm" action="/signup" method="post" autocomplete="on" novalidate>
        <div>
          <label for="nomeCompleto">Nome completo</label>
          <div class="input">
            <input id="nomeCompleto" name="name" type="text" placeholder="Seu nome completo" required aria-required="true" />
          </div>
        </div>

        <div>
          <label for="signupEmail">E-mail</label>
          <div class="input">
            <input id="signupEmail" name="user" type="email" inputmode="email" placeholder="seunome@aluno.uece.br" required aria-required="true" />
          </div>
        </div>

        <div>
          <label for="signupSenha">Senha</label>
          <div class="input">
            <input id="signupSenha" name="pass" type="password" placeholder="••••••••" required aria-required="true" />
            <button type="button" class="eye" aria-label="Mostrar senha"><i class="fa-solid fa-eye"></i></button>
          </div>
        </div>

        <div>
          <label for="signupSenha2">Confirmar senha</label>
          <div class="input">
            <input id="signupSenha2" name="pass2" type="password" placeholder="••••••••" required aria-required="true" />
            <button type="button" class="eye" aria-label="Mostrar senha"><i class="fa-solid fa-eye"></i></button>
          </div>
          <div id="pwdMatch" class="small" aria-live="polite" style="margin-top:6px;color:#666"></div>
        </div>

        <div style="display:flex;gap:10px;margin-top:8px">
          <button type="submit" class="btn" id="signupSubmit">Criar conta</button>
          <a class="btn secondary" href="index.html" id="backToLogin">Voltar</a>
        </div>

        <div class="error" id="signupError" role="alert"></div>
        <div class="help">Ao criar a conta, você poderá acessar seu calendário acadêmico.</div>
      </form>
    </section>
  </main>

  <script>
    (function(){
      const signupForm = document.getElementById('signupForm');
      const signupSubmit = document.getElementById('signupSubmit');
      const signupError = document.getElementById('signupError');
      const signupPwd = document.getElementById('signupSenha');
      const signupPwd2 = document.getElementById('signupSenha2');
      const pwdMatch = document.getElementById('pwdMatch');

      // coleta dados do formulário (use este objeto para enviar ao backend)
      function getSignupData() {
        return {
          name: document.getElementById('nomeCompleto').value.trim(),
          user: document.getElementById('signupEmail').value.trim(),
          pass: signupPwd.value,
          pass2: signupPwd2.value
        };
      }

      // stub para envio ao backend — substitua por fetch/axios quando tiver backend
      function sendSignup(data) {
        // Exemplo (descomente e ajuste a URL/headers quando pronto):
        /*
        return fetch('/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        }).then(res => res.json());
        */
        return null;
      }

      // toggle mostrar/ocultar senha (delegated via class "eye")
      document.addEventListener('click', function(e){
        const eye = e.target.closest('.eye');
        if (!eye) return;
        const parent = eye.parentElement;
        const input = parent.querySelector('input');
        if (!input) return;
        const type = input.type === 'password' ? 'text' : 'password';
        input.type = type;
        eye.innerHTML = type === 'password' ? '<i class="fa-solid fa-eye"></i>' : '<i class="fa-solid fa-eye-slash"></i>';
        eye.setAttribute('aria-pressed', type !== 'password');
      });

      // validação em tempo real das senhas
      function checkPasswordsMatch() {
        const a = signupPwd.value;
        const b = signupPwd2.value;
        if (!a && !b) {
          pwdMatch.textContent = '';
          signupSubmit.disabled = false;
          return;
        }
        if (a && b && a === b) {
          pwdMatch.textContent = 'As senhas coincidem.';
          pwdMatch.style.color = '#0a0';
          signupSubmit.disabled = false;
          return;
        }
        if (b) {
          pwdMatch.textContent = 'As senhas não conferem.';
          pwdMatch.style.color = '#c00';
        } else {
          pwdMatch.textContent = '';
        }
        signupSubmit.disabled = true;
      }

      signupPwd.addEventListener('input', checkPasswordsMatch);
      signupPwd2.addEventListener('input', checkPasswordsMatch);

      // submit: valida localmente e mostra UX de envio; fácil de trocar para envio via JS
      signupForm.addEventListener('submit', function(e){
        e.preventDefault();
        signupError.style.display = 'none';
        const payload = getSignupData();
        if (!payload.pass || !payload.pass2 || payload.pass !== payload.pass2) {
          signupError.textContent = 'As senhas não conferem.';
          signupError.style.display = '';
          return;
        }

        signupSubmit.disabled = true;
        signupSubmit.classList.add('loading');
        signupSubmit.textContent = 'Criando conta...';

        // envia como form-urlencoded para compatibilidade com @RequestParam no backend
        const formBody = new URLSearchParams({
          name: payload.name || '',
          user: payload.user || '',
          pass: payload.pass || ''
        });

        // BACKEND: endpoint esperado
        // POST /signup
        // - Content-Type: application/x-www-form-urlencoded (ou application/json se preferir)
        // - body (form-urlencoded): name=...&user=...&pass=...
        // - comportamento recomendado:
        //    * Em caso de sucesso: enviar redirect para página principal (login) ou já autenticar e redirecionar para calendário.
        //    * Em caso de validação: retornar 4xx com mensagem explicativa.
        // - Exemplo de resposta JSON desejada (opcional):
        //    { success: true, userId: 123, redirect: '/calendarComAgenda.html' }
        fetch('/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: formBody.toString(),
          redirect: 'follow'
        }).then(response => {
          // se backend redirecionou (controller usa sendRedirect), follow ocorreu e response.url terá destino
          if (response.redirected) {
            window.location.href = response.url;
            return;
          }
          // se não redirecionou, tenta ler texto/json para mensagem
          return response.text().then(txt => { throw new Error(txt || 'Erro ao criar conta'); });
        }).catch(err => {
          signupError.textContent = 'Erro ao criar conta. ' + (err.message || '');
          signupError.style.display = '';
        }).finally(()=> {
          signupSubmit.disabled = false;
          signupSubmit.classList.remove('loading');
          signupSubmit.textContent = 'Criar conta';
        });
      });

      // inicializa estado
      checkPasswordsMatch();
    })();
  </script>

  <script src="accessibility.js"></script>
</body>
</html>
